:{$PORT} {
    root * /usr/share/caddy
    file_server
    
    # Proxy all API requests
    # Using handle_path ensures /api/v1/auth/token is sent 
    # to the backend correctly
    handle /api/v1/* {
        reverse_proxy {$BACKEND_URL}
    }

    # Handle SPA routing for everything else
    handle {
        try_files {path} /index.html
    }
}